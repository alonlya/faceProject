# 人脸识别

#### 需求

通过接口进行,人脸库管理,人脸检测,人脸识别

#### 背景

实现人脸检测、识别和管理的需求。该方案将应用于人脸识别领域，通过云计算的高性能计算和存储资源，实现对人脸进行精准、高效的检测、识别和管理(chatgpt生成)

#### 已知资源

1.人脸特征向量提取demo(python)

2.可参考成熟项目的人脸对比:https://ai.baidu.com/ai-doc/FACE/yk37c1u4t

#### 需完成的难题

1.人脸特征向量对比算法

解决:欧式距离计算

2.人脸特征向量保存

解决:数据库保存.redis保存

3.调用向量提取模型

解决:接口调用

### 技术选型

#### 编程语言

##### java

优势:

1.熟悉java开发

2.拓展性和移植性强

3.性能高,有利于处理高并发和大数据量场景

劣势:

1.语言繁琐,使用spring开发时项目繁重

##### python

优势:

1.向量提取demo为python语言

2.有成熟的第三方库处理数据科学和机器学习,以及向量对比

劣势:

1.不熟悉python开发

2.性能低,不便于处理大数据量场景

#### 人脸特征向量对比(补全)

欧氏距离（Euclidean Distance）：

优点：简单易用，计算速度快，适用于特征向量的维度较低的情况。

缺点：对于高维向量来说，由于维度灾难的存在，欧氏距离容易受到维度的影响而导致计算结果不准确。

适用场景：当人脸特征向量的维度较低，并且计算速度要求较高的情况下，可以考虑使用欧氏距离来比较人脸特征向量之间的相似度。

余弦相似度（Cosine Similarity）：

优点：对于高维向量来说，余弦相似度不受维度灾难的影响，而且对于向量长度的变化不敏感，适用于高维向量之间的相似度比较。

缺点：余弦相似度无法处理向量之间的负相关性，可能导致结果不准确。

适用场景：当人脸特征向量的维度较高，并且向量之间可能存在负相关性的情况下，可以考虑使用余弦相似度来比较人脸特征向量之间的相似度。

皮尔逊相关系数（Pearson Correlation Coefficient）：

优点：皮尔逊相关系数可以处理向量之间的负相关性，能够更准确地衡量两个向量之间的相似度。

缺点：在向量的分布不均匀的情况下，皮尔逊相关系数容易出现误差。

适用场景：当人脸特征向量之间可能存在负相关性，并且向量的分布比较均匀的情况下，可以考虑使用皮尔逊相关系数来比较人脸特征向量之间的相似度。

曼哈顿距离（Manhattan Distance）：

优点：曼哈顿距离对于向量中每个维度的值变化不敏感，能够更好地处理向量之间的稀疏性，适用于稀疏向量之间的相似度比较。

缺点：曼哈顿距离不能很好地处理维度较高的向量，由于曼哈顿距离计算的是各维度的绝对距离之和，当维度很高时，可能会导致计算结果不准确。

适用场景：当人脸特征向量的维度较低，并且向量



512维的向量对比适合使用欧式距离向量对比法

![image-20230425171733173](/home/zoneyet/.config/Typora/typora-user-images/image-20230425171733173.png)

![image-20230425171754299](/home/zoneyet/.config/Typora/typora-user-images/image-20230425171754299.png)

#### 最终选型

语言:python

框架:flask

关系型数据库:mysql

非关系型数据库:redis

特征向量对比方法:欧式距离

### 功能模块设计

1.人脸检测模块

从输入的图像中检测出人脸并提取出人脸区域,收到图片信息后,调用人脸检测算法模型接口,获取人脸信息

2.人脸库管理模块

人脸库管理模块是该系统的重要功能模块，主要用于管理系统中的人脸库，包括人脸库的创建、删除、更新和查询等操作。该模块还需要提供一些基本的管理功能，如人脸库的备份和恢复等。为实现这些功能，可以采用数据库的方式来管理人脸库。使用MySQL等关系型数据库来存储人脸库的相关信息和特征向量。使用Redis等内存数据库来缓存人脸库的部分数据，以提高系统的读写性能和响应速度。

3,人脸识别模块

从输入额的图像中检测到人脸信息,收到图片信息后,调用人脸检测算法模型接口,获取当前图片的人脸信息,再使用人脸信息调用人脸特征提取接口,用提取到的人脸特征信息和redis中的人脸使用欧式距离计算向量差值,得到最小差值的数据

### 项目目录层级设计(补全)

app.py
├── api
│   ├── face.py
│   ├── __init__.py
├── config.py
├── model
│   ├── face.py
│   ├── __init__.py
├── utils
│   ├── __init__.py
│   ├── face_util.py
│   ├── compare_util.py
│   ├── cache_util.py
│   └── db_util.py
├── test
│   ├── __init__.py
│   ├── compare_test.py
│   ├── cache_test.py
│   ├── face_test.py
│   ├── util_test.py
│   └── db_test.py
└── README.md



这个项目是一个基于 Flask 框架实现的人脸识别系统，支持人脸检测、人脸特征向量提取、人脸库管理等功能。以下是对各个目录和文件的说明：

- `app.py`：应用程序入口，初始化 Flask 应用程序并注册蓝图、配置数据库和缓存等。

- ```
  api
  ```

   目录：包含了人脸识别系统的 API 接口，负责处理 HTTP 请求和响应，将请求传递给utils目录下的函数进行处理。

  - `face.py`：人脸识别相关 API 接口的实现，包括人脸检测、人脸特征向量提取、人脸库管理等。
  - `__init__.py`：初始化 Flask 蓝图。

- `config.py`：应用程序的配置文件，包括数据库和缓存配置、日志配置等。

- ```
  model
  ```

   目录：包含了与人脸识别相关的模型，例如人脸检测模型、人脸特征向量提取模型等。

  - `face.py`：人脸库的数据库模型。
  - `__init__.py`：初始化模型。

- ```
  utils
  ```

   目录：包含了与人脸识别相关的工具函数，例如数据库操作、缓存操作、人脸特征向量比较等。

  - `__init__.py`：初始化工具函数。
  - `face_util.py`：人脸识别相关的工具函数，例如人脸检测、人脸特征向量提取等。
  - `compare_util.py`：用于比较两个人脸特征向量之间的相似度。
  - `cache_util.py`：用于与 Redis 缓存进行交互，实现缓存的读取和写入。
  - `db_util.py`：用于与 MySQL 数据库进行交互，实现数据库的读取和写入。

- ```
  test
  ```

   目录：包含了单元测试文件。

  - `__init__.py`：初始化测试文件。
  - `compare_test.py`：用于测试比较两个人脸特征向量之间的相似度的函数是否正确。
  - `cache_test.py`：用于测试缓存读写的函数是否正确。
  - `face_test.py`：用于测试人脸识别相关的接口是否正确。
  - `util_test.py`：用于测试工具函数是否正确。
  - `db_test.py`：用于测试数据库读写的函数是否正确。

- `README.md`：说明文档，介绍了项目的背景、目录结构、使用方法等。

### AI编程方法封装顺序

封装方法:

问题出现原因:ai给出的代码差别较大,只关注业务本身,没有实现基础的功能代码

思路:进行项目架构拆分,拆分架构和功能粒度的同时,也要确定基础的功能方法模块

对于当前人脸识别项目:

目标功能

1.人脸检测

2.人脸识别

3.人脸库

基础模块:调用人脸检测接口(1,2,3),调用特征值提取接口(2,3),特征值对比方法(2)

优先级1.先实现人脸检测和特征值提取工具类

​			2.实现数据库管理,数据库设计

​			3.实现人脸库管理接口

​			4.实现特征值对比方法

​			5.实现缓存读取特征值,特征值对比业务

​			6.实现人脸识别接口

​			7.实现人脸检测接口			

具体实现文件顺序

1.cofig.py

2.db_util.py, model/face.py,  db_test.py

3.cache_util.py,  cache_test.py

4.face_util.py, util_test.py

5.compare_util.py,  compare_test.py

6.api/face.py,  face_test.py

### 数据库设计

![image-20230425171624225](/home/zoneyet/.config/Typora/typora-user-images/image-20230425171624225.png)

### 接口设计

##### 人脸检测接口

URL：/face_detection

Method：POST

请求参数：

| 参数名 | 类型   | 是否必须 | 描述             |
| ------ | ------ | -------- | ---------------- |
| image  | binary | 是       | base64待检测图片 |

返回值：

| 参数名  | 类型   | 描述     |
| ------- | ------ | :------- |
| success | bool   | 操作结果 |
| message | string | 返回信息 |
| data    | object | 人脸信息 |

##### 人脸库添加

URL：/face/add

Method：POST

请求参数：

| 参数名 | 类型   | 是否必须 | 描述           |
| ------ | ------ | -------- | -------------- |
| image  | binary | 是       | base64人脸图片 |
| name   | string | 是       | 姓名           |
| group  | string | 否       | 班组           |

返回值：

| 参数名  | 类型   | 描述     |
| ------- | ------ | -------- |
| success | bool   | 操作结果 |
| message | string | 返回信息 |

##### 人脸识别接口

URL：/face_recognition

Method：POST

请求参数：

| 参数名 | 类型 | 是否必须 | 描述           |
| ------ | ---- | -------- | -------------- |
| image  | file | 是       | base64人脸图片 |

返回值：

| 参数名  | 类型   | 描述                         |
| ------- | ------ | ---------------------------- |
| success | bool   | 操作结果                     |
| message | string | 返回信息                     |
| data    | array  | 人脸识别结果列表，包含人脸ID |

